# Importing data to Calkulate

All the code snippets below assume the import convention:

```python
import calkulate as calk
```

## Titration metadata Dataset

Calkulate essentially works by adding extra functions to a standard [pandas DataFrame](https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html).  The DataFrame with extra functions is called a Calkulate Dataset.  A Dataset consists of any number of separate titrations.

### Convert from a DataFrame

If your titration metadata is already imported as a DataFrame, you can directly convert it into a Dataset:

```python
ds = calk.Dataset(ds)
```

### Import from Excel, CSV or dbs

Or if your titration metadata is in an Excel spreadsheet, a CSV file, or a VINDTA-generated .dbs file, you can import these with:

```python
ds = calk.read_excel("path/to/metadata_file.xlsx")
ds = calk.read_csv("path/to/metadata_file.csv")
ds = calk.read_dbs("path/to/metadata_file.dbs")
```

`read_excel` and `read_csv` are light wrappers around the pandas functions of the same name.  You can add any kwargs needed by the pandas functions and they will be passed on.

`read_dbs` also renames several columns from their defaults to the names expected by Calkulate.

The columns in the Dataset [must be named in a specific way]().

## Individual titration data files

You don't need to manually import titration data files, but you should check that their format is consistent with what Calkulate expects, and work out what extra arguments you'll need to pass if not.

### The information they contain

Each titration file is a text file containing the measurements of the solution carried out during a titration.  The file should contain data in columns, where each row represents a measurement after a separate titrant addition.  There must be at least three columns:

  1. The amount of titrant added to the analyte in ml or g.
  2. The EMF measured across the titrant-analyte mixture in mV, or its pH.
  3. The temperature of the titrant-analyte mixture in Â°C.

### Their default format

By default, Calkulate expects that:

  * There are two lines at the start of the file to be ignored before the data columns described above begin.
  * The columns appear next, in the order given (from left to right).
  * The columns are tab-delimited.
  * Nothing comes after the columns of titration data in the file.

For example, a file could contain the following:

    This first line is ignored.
    This second line is also ignored.
    0.00    183.1   25.2
    0.50    225.4   25.1
    1.00    290.3   25.0
    1.50    343.4   25.1

**If your files look like the above (e.g. they were generated by a [VINDTA](http://www.marianda.com/index.php?site=products&subsite=vindta3c)), then you don't need to read any further on this page.**

### Dealing with other formats

All assumptions above about what your titration files look like can be adjusted.  The first thing you should do is work out what adjustments you need to make, if any.  You should repeat this each time you have a titration file in a new format.

If your titration data files come from a VINDTA, you should be able to skip this step.

Internally, Calkulate imports titration files using:

    :::python
    titration = calk.read_dat(
        fname,
        titrant_amount_col=0,
        measurement_col=1,
        temperature_col=2,
        delimiter="\t",
        skiprows=2,
        header=None,
        method="pandas",
        **read_dat_kwargs
    )

The only required input, `fname`, is the titration file name.  Calkulate imports the data from this file using [`pandas.read_table`](https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.read_table.html), which is where inputs `delimiter`, `skiprows`, and any other `read_dat_kwargs` that you may need to use are passed on to.

`read_dat` extracts the columns identified by `titrant_amount_col`, `measurement_col` and `temperature_col` into columns `"titrant_amount"`, `"measurement"` and `"temperature"` of a DataFrame called `titration`.

Before going further with Calkulate, you should make sure that you can import one of your titration files successfully using `calk.read_dat`.  You won't actually call this function directly, but you need to know any optional settings it requires for your titration files.  Assemble these optional settings in a dict and check they work.  For example, if you needed to skip 5 header lines, not 2, your file was comma-delimited, not tab-, and there was an extra column between the measurement data and the temperature:

```python
import calkulate as calk

# Assemble input arguments
file_name = "my_dat_file.dat"
read_dat_kwargs = {
    "skip_header": 5,
    "temperature_col": 3,
    "delimiter": ",",
}

# Run the import function
titration = calk.read_dat(file_name, **read_dat_kwargs)

# Check the output looks good
print(titration["titrant_amount")  # prints out the amount of titrant column
print(titration["measurement"])  # prints out the measurement column (e.g. EMF)
print(titration["temperature"])  # prints out the temperature
```

Keep a note of `read_dat_kwargs` - you'll need it later!

#### Metrohm 916 Ti-Touch

If your titration files were generated by a Metrohm 916 Ti-Touch Titrator (i.e. [they look like this](https://github.com/mvdh7/calkulate/blob/master/tests/data/PC_LIMS_Report-SEA2-20200317-130328.txt)) then you should be able to just use `calk.kwargs_TiTouch` as the `read_dat_kwargs` input.
